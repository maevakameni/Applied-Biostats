---
title: "informative title"
author: "Clara le Draoulec, Maeva Kameni"
date: "March 22, 2022"
output:
  pdf_document:
    fig_width: 5
    fig_height: 4
    fig_caption: true
    
geometry: margin=2.5cm
fontsize: 12 pt
header-includes:
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancyhead[R]{Clara le Draoulec, Maeva Kameni}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
```

## Introduction:
 quick background presentation + scientific question
 define all the variable: 
 
CITATION: The first variable considered is the degree of unionization of the manufacturing labor force. Second, a dummy variable is used for the classifications right-to-work states and union-
shop states. The third variable is a structural factor indicating the importance of relatively non-unionized industries in the economy of a given state. The fourth variable is the size of the agricultural labor force relative to the to- tal labor force.

Explanation of the variables in the text


```{r processing, echo = FALSE}
## Pre-processing:
#During this step, we will open the data file and make sur that every elements contained is properly #set and that the data variable is ready to be used for further analysis.
#open the data file

data <- read.table('data.rtf', header=FALSE, sep="", skip = 9)

#rename the column
names(data)[1] <- 'State_postal_abbreviation'
names(data)[2] <- 'Degree_of_conflict' #percentage of worker hours lost in stoppages
names(data)[3] <- 'Degree_of_unionization' #percent of workforce
names(data)[4] <- 'Union_shop_dummy' #1=Non-right to work 0=Right to work
names(data)[5] <- 'Sector' #percent in food, textiles and apparel
names(data)[6] <- 'Ag_force' #percent working in agriculture


#make sure the format is alright
data$Ag_force <-  gsub("\\\\", "", data$Ag_force)
data$Ag_force <- gsub("}", "", data$Ag_force)

#set the correct type to the different column
data$Ag_force <- as.numeric(data$Ag_force)

#The union-shop is already described as dummy, but we are going to check the class and change it to  factor
class(data$Union_shop_dummy)
#data$Union_shop_dummy <- as.factor(data$Union_shop_dummy) RETURN FALSE VALUES
```

## Exploratory Data Analysis:

```{r, echo = FALSE, results = 'asis'}
#Let's first get an insight on the differents column
summarize(data)
#xtable(summarize(data, type = "numeric", variables = "Union_shop_dummy"))
#x <- 
#print.xtable(summarize(data, type = "numeric"))
#x <- format(ftable(summary(data, type = "numeric")))
#x <- table(summary(data))
#knitr::kable(x)

knitr::kable(x = summary(data, digits = 2), 
      col.names = c("State postal abbreviation", "Degree of conflict", "Degree of unionization", "Union shop dummy", "Sector", "Ag force"),
      caption = "Summary of the variable factors")
```

```{r, echo = FALSE, eval=FALSE}
#check if there are missing values:
is.null(data)
```

```{r}
#Let's visualize the distributions in the different columns
par(mfrow=c(1,2))

#according to the different scales it is more appropriate to separate the first numerical column from the others.
boxplot(data[,c(3,5,6)], xlab = "Variables", main = "Boxplots of different numerical varibles", ylab = "Values", names=c("Degree of Unioniation","Sector","Ag Force")) 

#Boxplot of the outcome variable
boxplot(data[,2], xlab = "Degree of conflict", ylab = "Value", main = "Boxplot of the degree of conflict")

```
```{r, echo=FALSE}
#See if it is skewed or short-/long- tails
barplot(data$Degree_of_conflict, xlab = "Degree of conflict", ylab = "Value", main = "Boxplot of the degree of conflict")
```


Since there are some outliers, we will try to fit the model with or without them to access if these are influential points. (slide 68 Lecture 2)

For the dummy variable, a barplot is preferred to assess the distribution
```{r}
barplot(prop.table(table(data$Union_shop_dummy)), xlab = "Union shop status", ylab = "Frequencies", main = "Distribution of the union shop status")
```
Now we will analysis the distribution of the differents variable factors according to our groups namely Right-to-work states and Union-shop States (ca on maintien que c'est trop)

```{r}
#install.packages('prrr')
library('purrr')
split_sum <- data %>% split(.$Union_shop_dummy) %>% map(summary) 
knitr::kable(x = split_sum, 
      col.names = c("State postal abbreviation", "Degree of conflict", "Degree of unionization", "Union shop dummy", "Sector", "Ag force"),
      caption = "Summary of the variable factors")

```

Let's see how the variables are linked to each other before beginning the model fitting. It could help us make sure that the model fits properly afterwards. 

```{r, echo=FALSE}
#to assess the correlation between the variables (only the numerical one) we are going to plot scatter plots and the correlation coefficients associated

#function allowing to put the correlation cofficients on the plot
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- cor(x, y)
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = 1.1)
}


pairs(data[, 2:6], labels = c("Degree of conflict","Degree of unionization","Union Shop","Sector","Ag force"), main = "Correlation plots associated with the numerical variables with the Pearson correlation coefficient associated", cex.labels = 1.1, upper.panel = panel.cor)

```


## Statisitics and model fitting:

### First step: 
- The first step in the analysis is a direct comparison of the observed levels of industrial conflict in the right-to-work stated and union-shop states for the period 1957-1962

- the measure of industrial conflict is the proportion of time lost due to work stoppages (man hours relative to total estimated working time)
```{r, echo = FALSE}
#Lets investiagte if there is a significant difference in the degree of conflit between unionized and non-unionized states

ttest <- t.test(data[data$Union_shop_dummy =='0',]$Degree_of_conflict,data[data$Union_shop_dummy =='0',]$Degree_of_conflict)

#print('the t value for the comparison between the degree of conflict between unionized and non-unionized statses of '+ ttest$statistic+' with a p-value of'+ ttest$p.value) LIGNE MARCHE PAS
```

(RESULT PAPER: 
AVERAGE PER YEAR: 
right-to-work : 0.19% // non-right to work:0.24% --> significative at 5%

AVERAGE TOTAL MAN HOURS LOST: 
right to work: 267,151 hours per year // union-shop : 712,603 hours per year
--> significative 
--> causative factors: conceivably be favtor other than the existaence or non existence of a right to work law)


--> test the statements (better test t-test independant) : 
\section{- Agriculture > industry in right to work whereas industry  > agriculture. }

\section{" Where the relatively non-unionized agricultural sector is of major importance in the economy of a state, the theoretical level of industrial conflict should be less than where this is not the case".}

### Second step:
- Try to explain the outcome variable using the variable factors (variance explained R^2 maybe adj-R^2) 
--> multiple linear regression (2 digits and ^ on estimates) : state how model fitted (ie, LS) CLEARLY describe how model selected define all terms

--> assumptions of the multiple linear regression:
1. A linear relationship between the dependent and independent variables
2. The independent variables are not highly correlated with each other
3. The variance of the residuals is constant
4. Independence of observation

--> state the assumptions: (ON THE ERROR)
1. errors have mean 0
2. errors are homoscedastic (same variance) 
3. errors are uncorrelated
4. errors are normally distributed

```{r, echo = FALSE}
#linear Regression (WE KEEP THE INTERCEPT)

linear_mod <- lm(Degree_of_conflict ~ Degree_of_unionization + Union_shop_dummy + Sector + Ag_force  , data=data)  
summary(linear_mod)
```

#### Model Assessment:
- State how the model fitted (Ordinary Least square) degree_of_conflict ~ remaining variable factors
- check the assumptions --> qqplot of the residuals and residuals vs. fitted



```{r residuals, echo=FALSE}

linear_mod.resid <- residuals(linear_mod)
linear_mod.fitted <- fitted(linear_mod) 

plot(linear_mod.fitted,linear_mod.resid, main="Evolution of the residuals with respect to fitted values")
lines(smooth.spline(linear_mod.fitted, linear_mod.resid),lty=2 , col="black")

legend(x=2, y=1.7, legend=c("Fitting curve", "data points" ), col=c("black", 'black'), box.lty=0, lty= c(2 , NA), pch = c(NA, 1))
```
Commenter le plot 


```{r qqplot, echo=FALSE}
#create Q-Q plot for residuals
qqnorm(linear_mod.resid)

#add a straight diagonal line to the plot
qqline(linear_mod.resid) 
```
commenter le plot


```{r diagnostic plots, echo=FALSE}

```


## Conclusion

